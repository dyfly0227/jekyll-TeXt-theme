---
title: 'node替换图片颜色'
excerpt: 'node给图片改色修改透明度，以及替换图片中部分颜色'
tags: 'node'
---

替换图片中指定颜色，格式为rgb

> 有缺陷，rgb是有误差的，很多情况下替换不成功

```ts
const replaceColor = require('replace-color')
replaceColor({
  image: './test.png',
  colors: {
    type: 'rgb',
    targetColor: [218, 71, 77],
    replaceColor: [83, 158, 85]
  },
  deltaE: 10
})
  .then((jimpObject) => {
    jimpObject.write('./output.png', (err) => {
      if (err) return console.log(err)
    })
  })
  .catch((err) => {
    console.log(err)
  })
```
给图片改色以及修改透明度
```ts
import Jimp from 'jimp'
interface colorizeParams {
  img: string
  color: string // hex
  alpha: number
}
export async function colorizeImg(params: colorizeParams) {
  const imgBuffer = Buffer.from(
    params.img.replace(/^data:image\/\w+;base64,/, ''),
    'base64'
  )
  const image = await Jimp.read(imgBuffer)
  return new Promise((resolve, reject) => {
    image
      .color([
        {
          apply: 'red',
          params: [-255]
        },
        {
          apply: 'green',
          params: [-255]
        },
        {
          apply: 'blue',
          params: [-255]
        }
      ])
      .opacity(params.alpha / 100)
    image.color([
      {
        apply: 'xor',
        params: [params.color]
      }
    ])
    image.getBase64(image.getMIME(), (err, str) => {
      if (err) {
        reject()
      }
      resolve(str)
    })
  })
}
```